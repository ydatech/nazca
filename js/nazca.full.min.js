var nzc_textAlign={LEFT:1,CENTER:2,RIGHT:3};function nzc_escapeHtml(a){_times=function(b,e){for(var c=0,d="";c<e;c++){d+=b}return d};a=a.replace(/</g,"&lt;").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/&/g,"&amp;").replace(/\n$/,"<br/>&nbsp;").replace(/\n/g,"<br/>").replace(/ {2,}/g,function(b){return _times("&nbsp;",b.length-1)+" "});return a}(function(h){var g="0.1.0";var v={};var t={FACEBOOK:{width:446,height:374,ratio:1.1951871657754}};var l={BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38};var p={IMAGE:1,TEXT:2};var c={workspace:t.FACEBOOK};var k=false;if(("ontouchstart" in window)||window.DocumentTouch&&document instanceof DocumentTouch){k=true}console.log("Touch Events: "+(k?"supported":"not supported"));var o=0;var s={};h.fn.nazca=function(x){if(typeof(x)==="object"||!x){return v.init.apply(this,arguments)}else{if(v[x]){return v[x].apply(this,Array.prototype.slice.call(arguments,1))}else{h.error("Method "+x+" does not exists.")}}};v.init=function(y){var x=h.extend({},c,y);return this.each(function(){var E=h(this);if(E.hasClass("nazca-workspace")){return false}E.addClass("nazca-workspace");var A=E.width();var B=E.height();var G=A/B;if(c.workspace.ratio<G){A=B*c.workspace.ratio}else{B=A*c.workspace.ratio}E.css({width:A,height:B});var F=h('<div class="nazca-elements"></div>').appendTo(E);var H=h('<div class="nazca-resize-wrap" style="display:none;"><div class="nazca-resize-draggable"></div><a class="nazca-resize-control top-left"></a><a class="nazca-resize-control left"></a><a class="nazca-resize-control top-right"></a><a class="nazca-resize-control bottom-left"></a><a class="nazca-resize-control right"></a><a class="nazca-resize-control bottom-right"></a></div>').appendTo(E);var C=h('<div class="nazca-editor-controls" style="display:none;"></div>').appendTo(E);var D=++o;s[D]={$nazca:E,$nazca_elements:F,$nazca_resize_wrap:H,$nazca_editor_controls:C,opts:x,elements:[],active_element_id:0,element_last_id:0,scale_delta:A/c.workspace.width};var z=s[D];E.attr("data-nazca-id",D);h(document).bind("mousedown dragstart touchstart",function(J){if(!z.active_element_id){return false}var I=h(J.target);if(!I.parents(".nazca-resize-wrap").length&&!I.hasClass("nazca-resize-wrap")&&!I.parents(".element").length&&!I.hasClass("element")&&!I.parents(".nazca-editor-controls").length&&!I.hasClass("nazca-editor-controls")){H.hide();C.hide();var K=z.$nazca_resize_wrap.find(".nazca-resize-draggable");K.nzc_textarea("remove");z.active_element_id=0}});h(document).bind("keydown",function(J){if(J.which==l.DELETE&&z.active_element_id){var I=z.active_element_id;m(D,I)}})})};v.reset=function(){return this.each(function(){var x=h(this);var y=x.find(".nazca-elements");if(y){f(y)}delete s[parseInt(x.attr("data-nazca-id"))]})};v.addElements=function(x){return this.each(function(){var z=h(this);var y=z.attr("data-nazca-id");if(!y){return false}r(y,x)})};v.redrawElement=function(x){return this.each(function(){var z=h(this);var y=z.attr("data-nazca-id");if(!y){return false}var A=q(y,x);if(A){n(y,A)}})};v.getElementData=function(z){var y=h(this);var x=y.attr("data-nazca-id");if(!x){return false}return q(x,z)};v.setElementAttr=function(x,y,z){return this.each(function(){var B=h(this);var A=B.attr("data-nazca-id");if(!A){return false}u(A,x,y,z||null)})};v.removeElement=function(x){return this.each(function(){var z=h(this);var y=z.attr("data-nazca-id");if(!y){return false}m(y,x)})};function q(x,y){if(!x){return false}var z=s[x];for(var A in z.elements){if(z.elements[A]["id"]==y){return z.elements[A]}}return null}function r(x,A){var z=s[x];var y;if(Object.prototype.toString.call(A)!=="[object Array]"){A=[A]}for(i in A){y=n(x,A[i]);if(y){e(x,y)}}}function n(F,B){var x=s[F];var H=x.scale_delta;var C,D,G,A,J,z,y;if(typeof B!="object"){B=q(F,B);if(!B){return false}}var I=null;D=B;if(!D.id){D.id=++x.element_last_id;x.elements.push(D)}else{I=x.$nazca_elements.find('.element[data-id="'+D.id+'"]')}G=Math.round(D.width*H);A=Math.round(D.height*H);z=Math.round(D.x*H);J=Math.round(D.y*H);switch(D.type){case p.IMAGE:y="top:"+J+"px;left:"+z+"px;z-index:"+D.id+";width:"+G+"px;height:"+A+"px;";if(I){I.attr("style",y)}else{I=h('<div class="element image" data-id="'+D.id+'" style="'+y+'"><img src="'+D.src+'" width="100%" height="100%" /></div>').appendTo(x.$nazca_elements)}break;case p.TEXT:var E=D.textAlign==3?"right":(D.textAlign==2?"center":"left");y="top:"+J+"px;left:"+z+"px;z-index:"+D.id+";width:"+G+"px;height:auto;font-family:"+D.fontFamily+";font-size:"+D.fontSize+"px;line-height:"+Math.round(D.fontSize*1.2)+"px;color:"+D.color+";text-align:"+E+";";if(I){I.attr("style",y).html(nzc_escapeHtml(D.desc))}else{I=h('<div class="element text" data-id="'+D.id+'" style="'+y+'">'+nzc_escapeHtml(D.desc)+"</div>").appendTo(x.$nazca_elements)}break;default:break}I.trigger("nzc_draw");return I}function u(x,y,B,C){var z=s[x];for(var A in z.elements){if(z.elements[A]["id"]==y){if(B!==null&&typeof B==="object"){h.extend(z.elements[A],B)}else{z.elements[A][B]=C}return true}}return false}function m(x,z){var A=s[x];for(var B in A.elements){if(A.elements[B]["id"]==z){A.$nazca_editor_controls.hide();A.$nazca_resize_wrap.hide();A.elements.splice(B,1);var y=A.$nazca_elements.find('.element[data-id="'+z+'"]');y.trigger("nzc_remove").remove();A.active_element_id=0;return true}}return false}function f(x){x.empty()}function e(x,y){var z=s[x];var C=z.$nazca_elements.get(0);var A=Math.round(parseFloat(z.$nazca_resize_wrap.css("border-left-width")));var B=z.$nazca_editor_controls.height()+10;d(y,{container:C,onDragStart:function(){z.active_element_id=y.attr("data-id");z.$nazca_resize_wrap.css({width:y.width()+A*2,height:y.height()+A*2,top:parseFloat(y.css("top"))-A,left:parseFloat(y.css("left"))-A,zIndex:parseInt(y.css("zIndex"))});z.$nazca_editor_controls.show();z.$nazca_editor_controls.css({left:parseFloat(y.css("left"))-A,top:parseFloat(y.css("top"))-A-B});z.$nazca_editor_controls.nzc_image_controls("remove");z.$nazca_editor_controls.nzc_text_controls("remove");if(y.hasClass("image")){z.$nazca_editor_controls.nzc_image_controls("init",z.active_element_id)}else{z.$nazca_editor_controls.nzc_text_controls("init",z.active_element_id)}z.$nazca_resize_wrap.show();var H=z.$nazca_resize_wrap.find(".nazca-resize-draggable");H.nzc_textarea("remove");if(y.hasClass("text")){H.nzc_textarea("init",z.active_element_id)}w(H);d(H,{draggable:z.$nazca_resize_wrap.get(0),container:C,onDrag:function(I){y.css({left:I.position[0]+A,top:I.position[1]+A});u(x,z.active_element_id,{x:Math.round((I.position[0]+A)/z.scale_delta),y:Math.round((I.position[1]+A)/z.scale_delta)});z.$nazca_resize_wrap.css({left:I.position[0],top:I.position[1]});z.$nazca_editor_controls.css({left:I.position[0],top:I.position[1]-B,display:"none"})},onDragEnd:function(I){z.$nazca_editor_controls.show()}});var E=function(I){w(z.$nazca_resize_wrap.find("."+I))};var F,D;var G=function(I){d(z.$nazca_resize_wrap.find("."+I),{draggable:y.get(0),container:C,onDragStart:function(){F=y.width();D=y.height();z.$nazca_editor_controls.hide()},onDrag:function(Q){var K=null,J=null;switch(I){case"top-left":K=F-Q.distance[0];J=D-Q.distance[1];break;case"top-right":K=F+Q.distance[0];J=D-Q.distance[1];break;case"bottom-left":K=F-Q.distance[0];J=D+Q.distance[1];break;case"bottom-right":K=F+Q.distance[0];J=D+Q.distance[1];break;case"left":K=F-Q.distance[0];break;case"right":K=F+Q.distance[0];break;default:w(z.$nazca_resize_wrap.find("."+I));return false}if(K<=0||(J<=0&&J!==null)){return false}var L={width:K+2*A,height:(J!==null?J:y.height())+2*A};var N={width:K,height:J!==null?J:"auto"};var M={};switch(I){case"top-left":L.left=Q.position[0]-A;L.top=Q.position[1]-A;N.left=Q.position[0];N.top=Q.position[1];M.left=N.left;M.top=L.top-B;break;case"top-right":L.top=Q.position[1]-A;N.top=Q.position[1];M.top=L.top-B;break;case"bottom-left":L.left=Q.position[0]-A;N.left=Q.position[0];M.left=N.left;break;case"left":L.left=Q.position[0]-A;N.left=Q.position[0];M.left=N.left;default:break}z.$nazca_resize_wrap.css(L);y.css(N);z.$nazca_editor_controls.css(M);var P={};var R,S,O;for(var R in N){O=(R=="left"?"x":(R=="top"?"y":R));S=Math.round(N[R]/z.scale_delta);P[O]=S}u(x,z.active_element_id,P);y.trigger("nzc_resize",[N])},onDragEnd:function(){z.$nazca_editor_controls.show()}})};E("top-left");E("top-right");E("bottom-left");E("bottom-right");E("left");E("right");z.$nazca_resize_wrap.removeClass("nazca-wh-resizable nazca-w-resizable");if(y.hasClass("image")){G("top-left");G("top-right");G("bottom-left");G("bottom-right");z.$nazca_resize_wrap.addClass("nazca-wh-resizable")}else{G("left");G("right");z.$nazca_resize_wrap.addClass("nazca-w-resizable")}},onDrag:function(D){y.css({left:D.position[0],top:D.position[1]});u(x,z.active_element_id,{x:Math.round(D.position[0]/z.scale_delta),y:Math.round(D.position[1]/z.scale_delta)});z.$nazca_resize_wrap.css({left:D.position[0]-A,top:D.position[1]-A});z.$nazca_editor_controls.css({left:D.position[0]-A,top:D.position[1]-A-B,display:"none"})},onDragEnd:function(D){z.$nazca_editor_controls.show()}})}function d(x,y){var z=y;if(k){x.bind("touchstart",z,j)}else{x.bind("dragstart",function(){return false});x.bind("mousedown",z,j)}}function w(x){if(k){x.unbind("touchstart")}else{x.unbind("dragstart");x.unbind("mousedown")}}function j(J){var O=false;var A=J.data.draggable||this;var H=h(A);var L=J.data.container||H.parent().get(0);var C=J.data.onDragStart||null;var K=J.data.onDrag||null;var z=J.data.onDragEnd||null;var P=b(J.originalEvent);var N=a(A);var D=a(L);var R=P.pageX-N.left;var Q=P.pageY-N.top;var y=P.pageX;var x=P.pageY;var I=y-R-D.left;var B=x-Q-D.top;var M=I;var G=B;if(C){C.call(A)}var F=function(S){if(k){S.preventDefault();S.stopPropagation()}O=true;S=b(S.originalEvent);y=S.pageX;x=S.pageY;M=y-R-D.left;G=x-Q-D.top;if(K){K.call(A,{position:[M,G],distance:[M-I,G-B]})}else{A.style.left=M+"px";A.style.top=G+"px";A.style.right="auto";A.style.bottom="auto"}};var E=function(S){O=false;if(k){h("body").unbind("touchmove.nazcaEleDrag",F);h("body").unbind("touchend.nazcaEleDrag",E)}else{h(document).unbind("mousemove.nazcaEleDrag",F);h(document).unbind("mouseup.nazcaEleDrag",E)}if(z){z.call(A,{position:[M,G],distance:[M-I,G-B]})}};if(k){h("body").bind("touchmove.nazcaEleDrag",F);h("body").bind("touchend.nazcaEleDrag",E)}else{h(document).bind("mousemove.nazcaEleDrag",F);h(document).bind("mouseup.nazcaEleDrag",E)}}function b(z){z=z||window.event;if(!z.target){z.target=z.srcElement}if(typeof(z.touches)!="undefined"&&z.touches.length==1){delete z.pageX;delete z.pageY;z.pageX=z.touches[0].pageX;z.pageY=z.touches[0].pageY}else{if(z.pageX==null&&z.clientX!=null){var y=document.documentElement;var x=document.body;z.pageX=z.clientX+(y.scrollLeft||x&&x.scrollLeft||0);z.pageX-=y.clientLeft||0;z.pageY=z.clientY+(y.scrollTop||x&&x.scrollTop||0);z.pageY-=y.clientTop||0}if(!z.which&&z.button){z.which=z.button&1?1:(z.button&2?3:(z.button&4?2:0))}}return z}function a(A){var D=A.getBoundingClientRect();var E=document.body;var y=document.documentElement;var x=window.pageYOffset||y.scrollTop||E.scrollTop;var B=window.pageXOffset||y.scrollLeft||E.scrollLeft;var C=y.clientTop||E.clientTop||0;var F=y.clientLeft||E.clientLeft||0;var G=D.top+x-C;var z=D.left+B-F;return{top:Math.round(G),left:Math.round(z)}}}(jQuery));(function(d){var a="0.1.0";var b={};d.fn.nzc_image_controls=function(e){if(typeof(e)==="object"||!e){return b.init.apply(this,arguments)}else{if(b[e]){return b[e].apply(this,Array.prototype.slice.call(arguments,1))}else{d.error("Method "+e+" does not exists.")}}};b.init=function(e){return this.each(function(){if(!e){return false}var f=d(this);if(f.hasClass("nazca-image-controls")){return false}f.addClass("nazca-image-controls");f.attr("data-element-id",e);var g;g='<ul class="nav nav-nzc-controls"><li><a class="nzc-i-delete"><i class="fa fa-trash"></i></a></li></ul>';f.html(g);c(f)})};b.remove=function(e){return this.each(function(){var f=d(this);if(!f.hasClass("nazca-image-controls")){return false}f.removeClass("nazca-image-controls");f.removeAttr("data-element-id");f.empty()})};function c(e){var f=e.attr("data-element-id");e.find(".nzc-i-delete").click(function(g){e.parents(".nazca-workspace").nazca("removeElement",f)})}}(jQuery));(function(f){var a="0.1.0";var c={};f.fn.nzc_textarea=function(g){if(typeof(g)==="object"||!g){return c.init.apply(this,arguments)}else{if(c[g]){return c[g].apply(this,Array.prototype.slice.call(arguments,1))}else{f.error("Method "+g+" does not exists.")}}};c.init=function(g){return this.each(function(){if(!g){return false}var h=f(this);if(h.hasClass("nazca-textarea-wrap")){return false}h.addClass("nazca-textarea-wrap").attr("data-element-id",g).css("cursor","default");var j=f('<textarea id="nzc_t'+Math.round((Math.random()*(999999-0)+0))+'"></textarea>').appendTo(h);b(j,g);d(j,g)})};c.remove=function(){return this.each(function(){var g=f(this);if(!g.hasClass("nazca-textarea-wrap")){return false}e(g)})};function e(h,l){var j=h.parents(".nazca-workspace");var g=h.attr("data-element-id");var k=j.find('.element[data-id="'+g+'"]');if(typeof(l)=="undefined"){l=h.children("textarea")}f('.nzc_shadow[data-id="'+l.attr("id")+'"]').remove();h.removeAttr("data-element-id").removeClass("nazca-textarea-wrap").css("cursor","move");l.remove();f(window).unbind("resize.nzc_textarea");if(k.length){k.unbind("nzc_remove.nzc_textarea");k.unbind("nzc_resize.nzc_textarea");k.unbind("nzc_draw.nzc_textarea");k.css("visibility","visible")}}function b(n,h){var k=n.parents(".nazca-workspace");var m=k.find('.element[data-id="'+h+'"]');if(!m.length){return false}var g=k.nazca("getElementData",h);var l={color:m.css("color"),fontFamily:m.css("fontFamily"),fontSize:m.css("fontSize"),lineHeight:m.css("lineHeight"),textAlign:m.css("textAlign")};n.val(g.desc).css(l);m.css("visibility","hidden");var j=f('.nzc_shadow[data-id="'+n.attr("id")+'"]');if(!j.length){j=f('<div class="nzc_shadow"></div>').appendTo(document.body);j.attr("data-id",n.attr("id"))}j.css({position:"absolute",top:-10000,left:-10000,width:m.width(),fontSize:l.fontSize,fontFamily:l.fontFamily,lineHeight:l.lineHeight,resize:"none","word-wrap":"break-word"});return true}function d(n,g){var l=n.parents(".nazca-workspace");var m=l.find('.element[data-id="'+g+'"]');var j=n.parents(".nazca-resize-wrap");var h=f('.nzc_shadow[data-id="'+n.attr("id")+'"]');var k=function(p){var q=nzc_escapeHtml(n.val());if(p&&p.data&&p.data.event==="keydown"&&p.keyCode===13){q+="<br/>&nbsp;"}h.css("width",n.width());h.html(q);var o=h.height();if(o<=0){o=parseInt(n.css("lineHeight"))}n.height(o);j.height(o)};n.keydown({event:"keydown"},k).bind("change keyup",function(o){k(o);n.parents(".nazca-workspace").nazca("setElementAttr",g,{desc:n.val()});m.html(nzc_escapeHtml(n.val()))});f(window).bind("resize.nzc_textarea",k);m.bind("nzc_resize.nzc_textarea",function(o,p){k()});k(null);m.bind("nzc_draw.nzc_textarea",function(){b(n,g);k(null)}).bind("nzc_remove.nzc_textarea",function(){e(n.parent(),n)})}}(jQuery));(function(d){var a="0.1.0";var b={};d.fn.nzc_text_controls=function(e){if(typeof(e)==="object"||!e){return b.init.apply(this,arguments)}else{if(b[e]){return b[e].apply(this,Array.prototype.slice.call(arguments,1))}else{d.error("Method "+e+" does not exists.")}}};b.init=function(e){return this.each(function(){if(!e){return false}var f=d(this);if(f.hasClass("nazca-text-controls")){return false}f.addClass("nazca-text-controls");f.attr("data-element-id",e);var g;g='<ul class="nav nav-nzc-controls"><li class="dropdown"><a class="nzc-t-font" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-font"></i> Font <span class="caret"></span></a><ul class="nzc-t-font-dropdown dropdown-menu" role="menu"><li><a data-font="Arial">Arial</a></li><li><a data-font="Comic Sans MS">Comic Sans MS</a></li><li><a data-font="Georgia">Georgia</a></li><li><a data-font="Monotype Corsiva">Monotype Corsiva</a></li><li><a data-font="Times New Roman">Times New Roman</a></li></ul></li><li><a class="nzc-t-align" data-value="left"><i class="fa fa-align-left"></i></a></li><li><a class="nzc-t-align" data-value="center"><i class="fa fa-align-center"></i></a></li><li><a class="nzc-t-align" data-value="right"><i class="fa fa-align-right"></i></a></li><li class="dropdown"><a class="nzc-t-color" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-adjust"></i> Color <span class="caret"></span></a><ul class="nzc-t-color-dropdown dropdown-menu" role="menu"><li><a data-color="#000000">Black</a></li><li><a data-color="#1e84ab">Blue</a></li><li><a data-color="#f1c40f">Orange</a></li><li><a data-color="#ffffff">White</a></li></ul></li><li><a class="nzc-t-delete"><i class="fa fa-trash"></i></a></li></ul>';f.html(g);c(f)})};b.remove=function(e){return this.each(function(){var f=d(this);if(!f.hasClass("nazca-text-controls")){return false}f.removeClass("nazca-text-controls");f.removeAttr("data-element-id");f.empty()})};function c(e){var f=e.attr("data-element-id");e.find(".nzc-t-delete").click(function(g){e.parents(".nazca-workspace").nazca("removeElement",f)});e.find(".nzc-t-align").click(function(h){var g;switch(d(this).attr("data-value")){case"left":g=nzc_textAlign.LEFT;break;case"center":g=nzc_textAlign.CENTER;break;case"right":g=nzc_textAlign.RIGHT;break;default:break}e.parents(".nazca-workspace").nazca("setElementAttr",f,{textAlign:g}).nazca("redrawElement",f)});e.find(".nzc-t-font-dropdown>li>a").click(function(g){e.parents(".nazca-workspace").nazca("setElementAttr",f,{fontFamily:d(this).attr("data-font")}).nazca("redrawElement",f)});e.find(".nzc-t-color-dropdown>li>a").click(function(g){e.parents(".nazca-workspace").nazca("setElementAttr",f,{color:d(this).attr("data-color")}).nazca("redrawElement",f)})}}(jQuery));